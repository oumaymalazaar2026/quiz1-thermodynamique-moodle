<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Collectionneur - Ma√Ætrise & R√©flexion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes shine { 0% { background-position: -200% } 100% { background-position: 200% } }
        .rarity-legendary { 
            background: linear-gradient(90deg, #ffd700, #fff5b1, #ffd700);
            background-size: 200% auto;
            animation: shine 3s linear infinite;
            border: 2px solid #b8860b;
        }
        .rarity-rare { border: 2px solid #805ad5; background-color: #faf5ff; }
        .rarity-common { border: 2px solid #e2e8f0; background-color: #ffffff; }
        .card-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .badge-glow { filter: drop-shadow(0 0 20px rgba(234, 179, 8, 0.9)); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        #timer-bar { transition: width 1s linear; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col font-sans text-slate-900">

    <header class="bg-indigo-950 text-white p-6 shadow-2xl flex justify-between items-center border-b-4 border-yellow-500">
        <div>
            <h1 class="text-2xl font-black uppercase tracking-tight">Mission : Le Collectionneur</h1>
            <p class="text-indigo-300 text-sm italic">Apprentissage par l'erreur positive</p>
        </div>
        <div class="text-right">
            <span class="text-xl font-bold block leading-none">LAZAAR Oumayma</span>
            <span class="text-[10px] bg-indigo-700 px-2 py-1 rounded text-white mt-2 inline-block uppercase font-bold tracking-widest">Architecte P√©dagogique</span>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 max-w-5xl mx-auto w-full">
        
        <div class="flex justify-between items-center mb-2 px-2">
            <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Ma√Ætrise des concepts</span>
            <span class="text-sm font-black text-indigo-900 uppercase">Points : <span id="live-score" class="text-2xl text-indigo-600">0</span>/10</span>
        </div>
        <div class="mb-8 bg-slate-200 rounded-full h-3 overflow-hidden p-0.5">
            <div id="progress-bar" class="bg-indigo-600 h-full rounded-full transition-all duration-500 w-0"></div>
        </div>

        <section id="game-container" class="bg-white rounded-3xl shadow-xl p-6 md:p-10 mb-10 border border-slate-200 min-h-[480px] flex items-center justify-center">
            <div id="quiz-box" class="w-full">
                <div class="text-center py-10">
                    <span class="text-7xl mb-6 block">üí°</span>
                    <h2 class="text-3xl font-black text-slate-800 mb-4">Pr√™t pour le voyage cognitif ?</h2>
                    <p class="text-slate-500 mb-8 max-w-md mx-auto italic text-lg">"L'erreur n'est pas une faute, c'est un chemin vers la connaissance."</p>
                    <button onclick="startMission()" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xl font-bold py-4 px-12 rounded-2xl shadow-lg transition-all hover:scale-105">
                        D√©marrer la Mission
                    </button>
                </div>
            </div>
        </section>

        <section>
            <div class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4">
                <h3 class="text-2xl font-black text-indigo-950 uppercase flex items-center gap-3">
                    üì¶ Votre Collection <span id="badge-count" class="bg-indigo-950 text-white text-sm px-3 py-1 rounded-full">0</span>
                </h3>
            </div>
            <div id="inventory-grid" class="grid grid-cols-2 md:grid-cols-5 gap-4 p-6 bg-slate-200/50 rounded-3xl border-2 border-dashed border-slate-300 min-h-[150px]">
            </div>
        </section>
    </main>

    <script>
        const originalDatabase = [
            { q: "Qui a th√©oris√© le constructivisme cognitif ?", options: ["Piaget", "Vygotsky", "Skinner"], correctText: "Piaget", concept: "Jean Piaget", exp: "Piaget est l'initiateur de la construction active du savoir par l'apprenant." },
            { q: "Quel concept d√©signe l'√©cart entre ce qu'on sait faire seul et avec aide ?", options: ["L'accommodation", "La ZPD", "Le renforcement"], correctText: "La ZPD", concept: "La ZPD", exp: "La Zone de Proche D√©veloppement est le pilier du socio-constructivisme." },
            { q: "L'int√©gration d'une nouvelle information dans un sch√©ma existant est...", options: ["L'assimilation", "L'accommodation", "L'√©quilibration"], correctText: "L'assimilation", concept: "Assimilation", exp: "On assimile quand on int√®gre l'info sans modifier nos sch√©mas internes." },
            { q: "Modifier ses propres structures mentales pour s'adapter est...", options: ["L'assimilation", "L'accommodation", "L'imitation"], correctText: "L'accommodation", concept: "Accommodation", exp: "C'est l'effort de modification interne pour comprendre du nouveau." },
            { q: "Quel auteur met l'accent sur les interactions sociales ?", options: ["Bruner", "Vygotsky", "Watson"], correctText: "Vygotsky", concept: "Vygotsky", exp: "Il a montr√© que le savoir est d'abord social avant d'√™tre individuel." },
            { q: "Le soutien temporaire apport√© √† l'√©l√®ve par l'enseignant est :", options: ["Le tutorat", "L'√©chafaudage", "Le guidage"], correctText: "L'√©chafaudage", concept: "√âchafaudage", exp: "Le 'Scaffolding' de Bruner est essentiel pour guider sans faire √† la place de l'√©l√®ve." },
            { q: "Dans le constructivisme, l'erreur est consid√©r√©e comme...", options: ["Une faute √† punir", "Un outil pour apprendre", "Un manque de travail"], correctText: "Un outil pour apprendre", concept: "Erreur Positive", exp: "L'erreur permet de r√©ajuster ses hypoth√®ses de compr√©hension." },
            { q: "Le constructivisme s'oppose √† quelle vision de l'√©l√®ve ?", options: ["L'√©l√®ve acteur", "Le vase vide", "Le chercheur"], correctText: "Le vase vide", concept: "Apprenant Actif", exp: "L'√©l√®ve n'est pas passif, il 'construit' sa r√©alit√©." },
            { q: "Le 'conflit socio-cognitif' se produit quand...", options: ["On se bat avec un pair", "On confronte des avis diff√©rents", "On √©choue seul"], correctText: "On confronte des avis diff√©rents", concept: "Conflit Social", exp: "C'est la confrontation des id√©es qui force le cerveau √† progresser." },
            { q: "Le savoir n'est pas transmis, il est...", options: ["Copi√©", "Construit", "M√©moris√©"], correctText: "Construit", concept: "Savoir Construit", exp: "Le savoir est une architecture interne construite par l'apprenant." }
        ];

        let database = [];
        let currentIdx = 0;
        let score = 0;
        let inventory = [];
        let userChoices = [];
        let timer;
        let timeLeft;
        const TIME_LIMIT = 15;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startMission() {
            database = shuffleArray([...originalDatabase]);
            database.forEach(q => q.options = shuffleArray([...q.options]));
            currentIdx = 0;
            score = 0;
            inventory = [];
            userChoices = [];
            updateStats();
            renderInventory();
            showQuestion();
        }

        function updateStats() {
            document.getElementById('live-score').innerText = score;
            document.getElementById('progress-bar').style.width = `${(currentIdx / 10) * 100}%`;
            document.getElementById('badge-count').innerText = inventory.length;
        }

        function showQuestion() {
            if (currentIdx >= 10) {
                clearInterval(timer);
                renderEndScreen();
                return;
            }

            updateStats();
            const data = database[currentIdx];
            timeLeft = TIME_LIMIT;

            let html = `
                <div class="card-pop w-full">
                    <div class="w-full bg-slate-100 h-2 rounded-full mb-6 overflow-hidden">
                        <div id="timer-bar" class="bg-indigo-500 h-full w-full"></div>
                    </div>
                    <span class="text-indigo-600 font-black uppercase text-[10px] tracking-[0.2em]">√âtape ${currentIdx + 1} sur 10</span>
                    <h2 class="text-2xl font-bold mt-4 mb-8 text-slate-800 leading-tight">${data.q}</h2>
                    <div class="grid gap-4">
            `;
            data.options.forEach((opt) => {
                html += `
                    <button onclick="handleSelection('${opt.replace(/'/g, "\\'")}')" class="text-left p-5 rounded-2xl border-2 border-slate-100 hover:border-indigo-600 hover:bg-indigo-50 transition-all font-semibold flex justify-between items-center group active:scale-95">
                        ${opt}
                        <span class="opacity-0 group-hover:opacity-100 transition-all">Choisir ‚ûú</span>
                    </button>`;
            });
            html += `</div></div>`;
            document.getElementById('quiz-box').innerHTML = html;

            startTimer();
        }

        function startTimer() {
            const bar = document.getElementById('timer-bar');
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                bar.style.width = (timeLeft / TIME_LIMIT) * 100 + "%";
                if (timeLeft <= 5) bar.style.backgroundColor = "#ef4444";
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    handleSelection("TEMPS √âCOUL√â");
                }
            }, 1000);
        }

        function handleSelection(selectedText) {
            clearInterval(timer);
            const data = database[currentIdx];
            const isCorrect = selectedText === data.correctText;
            
            // √âcran de feedback interm√©diaire (Style P√©dagogie Positive)
            let feedbackHtml = `
                <div class="card-pop text-center py-6">
                    <div class="text-6xl mb-6">${isCorrect ? '‚ú®' : 'üßê'}</div>
                    <h2 class="text-3xl font-black ${isCorrect ? 'text-green-600' : 'text-amber-600'} mb-4">
                        ${isCorrect ? 'Excellent !' : 'Pensez-y encore...'}
                    </h2>
                    <p class="text-slate-600 mb-8 px-6 max-w-md mx-auto italic">
                        ${isCorrect ? 'Vous avez parfaitement saisi ce concept.' : 'Cette notion m√©rite une r√©flexion plus approfondie. Observez bien la correction finale pour mieux comprendre.'}
                    </p>
                    <button onclick="proceed(${isCorrect}, '${selectedText.replace(/'/g, "\\'")}')" class="bg-slate-900 text-white px-12 py-4 rounded-2xl font-bold hover:bg-indigo-600 transition-all shadow-lg">
                        Continuer l'exploration
                    </button>
                </div>
            `;
            document.getElementById('quiz-box').innerHTML = feedbackHtml;
        }

        function proceed(isCorrect, selectedText) {
            const data = database[currentIdx];
            if (isCorrect) {
                score++;
                generateLoot(data.concept);
            }
            
            userChoices.push({ selected: selectedText, correct: isCorrect });
            currentIdx++;
            showQuestion();
        }

        function generateLoot(conceptName) {
            const rand = Math.random();
            let rarity = rand > 0.85 ? "legendary" : (rand > 0.60 ? "rare" : "common");
            let emoji = rarity === "legendary" ? "‚≠ê" : (rarity === "rare" ? "‚ú®" : "üìú");
            inventory.push({ name: conceptName, rarity: rarity, emoji: emoji });
            renderInventory();
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            if (inventory.length === 0) {
                grid.innerHTML = `<p class="col-span-full text-center text-slate-400 py-6 italic text-sm">Votre inventaire est pr√™t √† recevoir vos succ√®s.</p>`;
                return;
            }
            grid.innerHTML = inventory.map(item => `
                <div class="card-pop p-3 rounded-2xl shadow-sm text-center border bg-white rarity-${item.rarity} transition-transform hover:scale-110">
                    <span class="text-2xl block mb-1">${item.emoji}</span>
                    <span class="text-[9px] font-black uppercase text-indigo-950 block leading-tight">${item.name}</span>
                </div>
            `).join('');
        }

        function renderEndScreen() {
            updateStats();
            let mention = score === 10 ? "GRAND MA√éTRE" : (score >= 7 ? "EXPERT" : "APPRENTI");
            
            document.getElementById('quiz-box').innerHTML = `
                <div class="text-center py-4 card-pop">
                    ${score === 10 ? '<div class="badge-glow text-8xl mb-6">üéñÔ∏è</div>' : '<div class="text-6xl mb-6">üèÅ</div>'}
                    <h2 class="text-6xl font-black text-indigo-950 mb-2">${score}/10</h2>
                    <p class="text-xl font-bold text-slate-500 mb-10 tracking-widest uppercase">STATUT : ${mention}</p>
                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <button onclick="showDetailedCorrection()" class="bg-indigo-600 text-white px-10 py-4 rounded-2xl font-black hover:bg-indigo-700 shadow-xl transition-all">ANALYSER LE RAPPORT</button>
                        <button onclick="location.reload()" class="bg-slate-200 text-slate-700 px-10 py-4 rounded-2xl font-bold hover:bg-slate-300 transition">RECOMMENCER</button>
                    </div>
                </div>
            `;
        }

        function showDetailedCorrection() {
            let html = `<div class="card-pop text-left max-w-3xl mx-auto"><h2 class="text-2xl font-black text-indigo-950 uppercase mb-6 border-b pb-4 tracking-tighter">Rapport de Ma√Ætrise</h2><div class="space-y-4 max-h-[500px] overflow-y-auto pr-4">`;

            database.forEach((data, i) => {
                const uc = userChoices[i];
                html += `
                    <div class="p-6 rounded-3xl border-2 ${uc.correct ? 'border-green-100 bg-green-50' : 'border-red-100 bg-red-50'}">
                        <p class="font-black text-slate-800">${i+1}. ${data.q}</p>
                        <p class="text-sm mt-2"><strong>Votre choix :</strong> <span class="${uc.correct ? 'text-green-600' : 'text-red-600'}">${uc.selected}</span></p>
                        ${!uc.correct ? `<p class="text-sm text-green-700 font-bold">R√©ponse correcte : ${data.correctText}</p>` : ''}
                        <div class="mt-4 p-4 bg-white/80 rounded-2xl text-xs text-slate-600 border border-white leading-relaxed italic">
                            <strong>Note p√©dagogique :</strong> ${data.exp}
                        </div>
                    </div>
                `;
            });

            html += `</div><button onclick="renderEndScreen()" class="mt-6 w-full py-4 bg-slate-100 font-bold rounded-xl hover:bg-slate-200 transition">Fermer le rapport</button></div>`;
            document.getElementById('quiz-box').innerHTML = html;
        }
    </script>
</body>
</html>
