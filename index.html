<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission : Le Thermodynamitien</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
.card-pop { animation: pop 0.3s ease-out; }
@keyframes pop { from{transform:scale(0.9);opacity:0} to{transform:scale(1);opacity:1} }
</style>
</head>

<body class="bg-slate-50 min-h-screen flex flex-col font-sans">

<header class="bg-indigo-950 text-white p-6 shadow-2xl flex justify-between items-center border-b-4 border-yellow-500">
  <div>
    <h1 class="text-2xl font-black uppercase tracking-tight">Mission : Le Thermodynamitien</h1>
    <p class="text-[#d4a373] text-sm italic">Axe 1 : Outils Math√©matiques</p>
  </div>
  <div class="text-right border-l border-[#d4a373] pl-4">
    <span id="studentDisplay" class="text-lg font-bold underline decoration-[#bc6c25]">PR√âNOM NOM</span>
    <span class="text-[9px] uppercase font-bold tracking-widest opacity-80 block">Physique-Chimie</span>
  </div>
</header>

<main class="flex-grow p-6 max-w-4xl mx-auto w-full">

<div class="mb-4 flex justify-between">
  <span class="font-bold text-slate-500">Progression</span>
  <span class="font-black">Score : <span id="live-score">0</span>/10</span>
</div>

<div class="bg-slate-200 rounded-full h-3 overflow-hidden mb-8">
  <div id="progress-bar" class="bg-indigo-600 h-full w-0 transition-all"></div>
</div>

<section id="game-container" class="bg-white rounded-3xl shadow-xl p-10 min-h-[420px] flex items-center justify-center">

<div id="quiz-box" class="w-full text-center">

<div class="text-6xl mb-6">üîê</div> 
<h2 class="text-2xl font-black mb-4 uppercase">D√©chiffrez les D√©riv√©es</h2>
<p class="text-slate-500 italic mb-8">
Calculez les valeurs exactes pour d√©verrouiller le savoir.
</p>

<input id="studentName" placeholder="Entrez votre nom"
class="mb-2 px-4 py-3 rounded-xl border w-80 text-center font-bold">

<p id="nameError" class="text-red-600 text-sm hidden mb-4">
Veuillez entrer votre nom.
</p>

<button onclick="startMission()"
class="bg-indigo-600 text-white text-xl font-bold py-4 px-12 rounded-2xl hover:bg-indigo-700">
D√©marrer la Mission
</button>

</div>
</section>

<h3 class="text-2xl font-black mt-10 mb-4">üì¶ Cartes gagn√©es</h3>
<div id="inventory-grid" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>

</main>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbyUcnq4xNj_kHbzXkmT9rwq42yCjt0Pgplndh0nVE3jHiD1oIhMumqpGkGBNx4oFJpf_w/exec";

const originalDatabase = [
{ q:"Qui a th√©oris√© le constructivisme ?", options:["Piaget","Vygotsky","Skinner"], correctText:"Piaget", exp:"Jean Piaget est le p√®re du constructivisme." },
{ q:"Zone entre autonomie et aide ?", options:["Assimilation","ZPD","Renforcement"], correctText:"ZPD", exp:"ZPD = Zone de Proche D√©veloppement." },
{ q:"Int√©grer sans modifier ?", options:["Assimilation","Accommodation","√âquilibration"], correctText:"Assimilation", exp:"Assimilation = int√©grer sans changer." },
{ q:"Modifier ses sch√©mas ?", options:["Assimilation","Accommodation","Imitation"], correctText:"Accommodation", exp:"Accommodation = changer sa structure mentale." },
{ q:"Auteur des interactions sociales ?", options:["Bruner","Vygotsky","Watson"], correctText:"Vygotsky", exp:"Vygotsky = apprentissage social." },
{ q:"Soutien temporaire ?", options:["Tutorat","√âchafaudage","Guidage"], correctText:"√âchafaudage", exp:"Scaffolding p√©dagogique." },
{ q:"L'erreur est ?", options:["Une faute","Un outil","Un √©chec"], correctText:"Un outil", exp:"L'erreur aide √† apprendre." },
{ q:"Vision oppos√©e au constructivisme ?", options:["√âl√®ve acteur","Vase vide","Chercheur"], correctText:"Vase vide", exp:"L'√©l√®ve n'est pas passif." },
{ q:"Conflit socio-cognitif ?", options:["Se battre","Confronter id√©es","√âchouer"], correctText:"Confronter id√©es", exp:"Le d√©bat fait progresser." },
{ q:"Le savoir est ?", options:["Copi√©","Construit","M√©moris√©"], correctText:"Construit", exp:"Le savoir se construit." }
];

let database=[], currentIdx=0, score=0, inventory=[], userChoices=[], attempts=0;

function shuffle(a){
 for(let i=a.length-1;i>0;i--){
  const j=Math.floor(Math.random()*(i+1));
  [a[i],a[j]]=[a[j],a[i]];
 }
 return a;
}

function startMission(){
 const name=document.getElementById("studentName").value.trim();
 if(!name){
  document.getElementById("nameError").classList.remove("hidden");
  return;
 }
 document.getElementById("nameError").classList.add("hidden");
 window.currentStudentName=name;
 document.getElementById("studentDisplay").innerText=name;

 database=shuffle([...originalDatabase]);
 database.forEach(q=>q.options=shuffle([...q.options]));
 currentIdx=0; score=0; inventory=[]; userChoices=[];
 showQuestion();
}

function updateStats(){
 document.getElementById("live-score").innerText=score;
 document.getElementById("progress-bar").style.width=(currentIdx/database.length*100)+"%";
}

function showQuestion(){
 if(currentIdx>=database.length){ renderEnd(); return; }

 updateStats();
 attempts=0;

 const d=database[currentIdx];
 let html=`<div class="card-pop">
 <h2 class="text-2xl font-bold mb-6">${d.q}</h2>
 <div class="grid gap-4">`;

 d.options.forEach(opt=>{
  html+=`<button onclick="handleSelection('${opt}')"
  class="p-4 border rounded-xl hover:bg-indigo-50 font-bold">${opt}</button>`;
 });

 html+=`</div></div>`;
 document.getElementById("quiz-box").innerHTML=html;
}

function handleSelection(choice){
 const d=database[currentIdx];
 const correct=choice===d.correctText;

 saveAnswer(window.currentStudentName,d.q,choice,correct);

 if(correct){
  score++;
  inventory.push(d.correctText);
  showFeedback(true,d);
 } else {
  attempts++;
  if(attempts<2){
   showRetry();
  } else {
   showFeedback(false,d);
  }
 }
}

function showRetry(){
 document.getElementById("quiz-box").innerHTML=`
 <div class="card-pop">
 <div class="text-6xl mb-4">üßê</div>
 <h2 class="text-2xl font-black text-amber-600">Pensez bien...</h2>
 <button onclick="showQuestion()"
 class="mt-6 bg-indigo-600 text-white px-10 py-3 rounded-xl">R√©essayer</button>
 </div>`;
}

function showFeedback(success,d){
 let msg=success?"Excellent, continuez !":"Solution : "+d.correctText;

 document.getElementById("quiz-box").innerHTML=`
 <div class="card-pop">
 <div class="text-6xl mb-4">${success?"‚ú®":"‚ùå"}</div>
 <h2 class="text-2xl font-black">${msg}</h2>
 <p class="italic text-slate-500 mt-4">${d.exp}</p>
 <button onclick="nextQuestion()"
 class="mt-6 bg-indigo-600 text-white px-10 py-3 rounded-xl">Continuer</button>
 </div>`;

 renderInventory();
}

function nextQuestion(){
 currentIdx++;
 showQuestion();
}

function renderInventory(){
 const grid=document.getElementById("inventory-grid");
 grid.innerHTML=inventory.map(c=>`
 <div class="bg-white p-3 rounded-xl shadow text-center border">
 <span class="text-2xl">üé¥</span>
 <p class="text-xs font-bold">${c}</p>
 </div>`).join("");
}

function renderEnd(){
 document.getElementById("quiz-box").innerHTML=`
 <div class="card-pop text-center">
 <div class="text-7xl mb-4">üèÅ</div>
 <h2 class="text-4xl font-black">${score}/${database.length}</h2>
 <p class="italic text-slate-500 mb-6">Mission termin√©e</p>
 <button onclick="location.reload()"
 class="bg-indigo-600 text-white px-12 py-4 rounded-xl">Recommencer</button>
 </div>`;
}

function saveAnswer(nom,question,reponse,correct){
 fetch(SHEET_URL,{
  method:"POST",
  mode:"no-cors",
  headers:{ "Content-Type":"application/json" },
  body:JSON.stringify({nom,question,reponse,correct})
 });
}
</script>

</body>
</html>
